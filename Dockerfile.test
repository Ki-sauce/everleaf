# Emergency Test Dockerfile - Just Node.js app without TexLive
# Use this to verify Railway deployment works, then add TexLive later

FROM node:20-slim

# Set environment
ENV NODE_ENV=production

# Create app directory
WORKDIR /app

# Create non-root user
RUN groupadd -r appuser && useradd -r -g appuser appuser

# Copy package files
COPY everleaf-backend/package*.json ./

# Install dependencies
RUN npm ci --only=production --silent && npm cache clean --force

# Copy app source
COPY everleaf-backend/ ./

# Create directories
RUN mkdir -p /tmp/latex /app/uploads && \
    chown -R appuser:appuser /app /tmp/latex

# Switch to non-root user
USER appuser

# Expose port
EXPOSE 5000

# Simple health check (modify your health endpoint to not require pdflatex)
HEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3 \
    CMD curl -f http://localhost:5000/api/latex/health || exit 1

# Start application
CMD ["npm", "start"]